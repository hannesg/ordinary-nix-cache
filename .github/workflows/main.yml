on: [push]

jobs:
  nix-build:
    runs-on: ubuntu-latest
    name: Test caching works
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - uses: DeterminateSystems/nix-installer-action@main
      - name: Setup Cache
        uses: ./
      - name: Nix build
        run: nix-build --expr 'derivation { name = "dummy"; builder = "/bin/sh"; system = builtins.currentSystem;  args = ["-c" "echo ${{github.sha}} > $out"];}'
      - name: Check nix cache
        run: nix store ls --store $ORDINARY_NIX_CACHE ./result
